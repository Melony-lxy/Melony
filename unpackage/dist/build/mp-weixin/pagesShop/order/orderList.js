require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesShop/order/orderList"],{"0ceb":function(t,e,i){"use strict";(function(t,e){var n=i("47a9");i("6103");n(i("3240"));var r=n(i("435b"));t.__webpack_require_UNI_MP_PLUGIN__=i,e(r.default)}).call(this,i("3223")["default"],i("df3c")["createPage"])},"435b":function(t,e,i){"use strict";i.r(e);var n=i("a39a"),r=i("637a");for(var s in r)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return r[t]}))}(s);i("472d");var o=i("828b"),a=Object(o["a"])(r["default"],n["b"],n["c"],!1,null,"75aacd2f",null,!1,n["a"],void 0);e["default"]=a.exports},"472d":function(t,e,i){"use strict";var n=i("ad5c"),r=i.n(n);r.a},"637a":function(t,e,i){"use strict";i.r(e);var n=i("9536"),r=i.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(s);e["default"]=r.a},9536:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i("bd40"),r={WECHAT:1,WECHAT_CH:"微信",ALIPAY:2,ALIPAY_CH:"支付宝"},s={data:function(){return{record:null,show1:!1,paymentMethod:1,count:0,currId:0,isMore:!1,page:1,limit:10,query:{},dx:0,searchText:"",list:[{name:"全部"},{name:"待付款"},{name:"待发货"},{name:"待收货"},{name:"待评价"},{name:"已取消"},{name:"已完成"}],currStatus:0,swiperCurrent:0,orderList:[[],[],[],[],[],[],[]],paymentList:[],payment:0,totalPrices:0}},onShow:function(){if(this.paymentList=[{id:r.WECHAT,img:"/static/wechat.png",name:r.WECHAT_CH,styles:"width:30rpx;height:30rpx"}],this.currStatus=parseInt(this.$route.query.id),this.swiperCurrent=this.$route.query.id,this.$route.query.id)return this.query={status:this.$route.query.id-1},void this.getList("change");this.query={status:-1},this.getList("change")},methods:{totalPrice:function(t){return(100*t.price/100+t.postage).toFixed(2)},search:function(t){this.query=t?{search:t,status:this.currStatus-1}:{status:-1},this.getList("change")},payOrder:function(t){if(1===this.paymentList.length)this.paymentOrder(t);else{var e=t.payment;this.record=t,this.totalPrices=t.total_price,this.payment=e==r.WECHAT?0:1,this.show1=!0}},paymentOrder:function(e){var i=this;t.showLoading({title:"加载中"});var s=e.id,o=this.paymentList[this.payment].id;if(o===r.WECHAT){(0,n.WxPayOrder)({id:s,status:0,openId:t.getStorageSync("openId")}).then((function(e){t.hideLoading(),0===e.code&&i.common.payment(e.data).then((function(t){0===t.code&&i.paymentSuccess()})).catch((function(t){}))})).catch((function(){t.hideLoading()}))}else o===r.ALIPAY?(0,n.AliPayOrder)({id:this.orderId}).then((function(e){t.hideLoading(),document.querySelector("body").innerHTML=e.data.resp,document.forms[0].submit()})).catch((function(){t.hideLoading()})):t.hideLoading()},paymentSuccess:function(){t.showModal({title:"提示",content:"支付成功",showCancel:!1,confirmText:"关闭",success:function(t){}})},confirmReceipt:function(e){var i=this;if(0===e.status&&this.payOrder(e),2===e.status)return t.showLoading({title:"加载中"}),void(0,n.confirmReceipt)({id:e.id}).then((function(e){t.showToast({icon:"none",title:"成功"}),i.isMore=!1,i.query={status:-1},i.swiperCurrent=0,i.getList("change")}));3===e.status&&t.navigateTo({url:"/pagesShop/commodity/addComment?id="+e.id})},specificationsStatus:function(t){return t.specifications.map((function(t){return t.name})).join("/")},cancelOrder:function(e){var i=this;t.showModal({title:"确定要取消该订单吗？",success:function(r){r.confirm&&(t.showLoading({title:"加载中"}),(0,n.cancel)({id:e}).then((function(e){0===e.code&&(t.showToast({icon:"none",title:"取消成功"}),i.query={status:-1},i.getList("change")),t.hideLoading()})).catch((function(e){t.showToast({icon:"error",title:"错误："+e})})))}})},status:function(t){return 0===t.status?"待支付":1===t.status?"待发货":2===t.status?"待收货":3===t.status?"待评价":4===t.status?"已取消":"已完成"},skip:function(e,i){e?(this.isMore=!this.isMore,t.navigateTo({url:i+"?id="+e})):t.navigateTo({url:"/pagesShop/order/afterSale"})},getList:function(e){var i=this;console.log(this.query,"this.query"),(0,n.listJson)({page:this.page,limit:this.limit,query:this.query}).then((function(n){var r=n.data.data;"change"===e?(console.log(2),i.orderList[i.query.status+1]=r):i.orderList[i.query.status+1].concat(r),i.count=n.data.totalCount,t.hideLoading(),i.$forceUpdate()}))},moreChange:function(t){this.isMore=!this.isMore,this.currId=t},change:function(t){this.isMore=!1,this.swiperCurrent=t},transition:function(t){var e=t.detail.dx;this.$refs.tabs.setDx(e)},animationfinish:function(e){var i=e.detail.current;this.currStatus!==i&&(t.showLoading({title:"加载中"}),this.query={status:i-1},this.getList("change")),this.$refs.tabs.setFinishCurrent(i),this.currStatus=i,this.swiperCurrent=i},onreachBottom:function(){if(this.orderList[this.currStatus].length<this.count)return t.showLoading({title:"加载中"}),this.page=2,this.query={status:this.currStatus-1},void this.getList();t.showToast({icon:"none",title:"到底了"})}}};e.default=s}).call(this,i("df3c")["default"])},a39a:function(t,e,i){"use strict";i.d(e,"b",(function(){return r})),i.d(e,"c",(function(){return s})),i.d(e,"a",(function(){return n}));var n={uSearch:function(){return i.e("uview-ui/components/u-search/u-search").then(i.bind(null,"6c14"))},uTabsSwiper:function(){return Promise.all([i.e("common/vendor"),i.e("uview-ui/components/u-tabs-swiper/u-tabs-swiper")]).then(i.bind(null,"cdf0"))},uGap:function(){return i.e("uview-ui/components/u-gap/u-gap").then(i.bind(null,"021c"))},uEmpty:function(){return i.e("uview-ui/components/u-empty/u-empty").then(i.bind(null,"87a0"))},uPopup:function(){return i.e("uview-ui/components/u-popup/u-popup").then(i.bind(null,"aa1b"))}},r=function(){var t=this,e=t.$createElement,i=(t._self._c,t.__map(t.orderList,(function(e,i){var n=t.__get_orig(e),r=e.length,s=0!==r?t.__map(e,(function(e,i){var n=t.__get_orig(e),r=t.status(e),s=t.__map(e.product,(function(e,i){var n=t.__get_orig(e),r=t.common.imgUrl(e.img),s=t.specificationsStatus(e);return{$orig:n,g1:r,m1:s}})),o=t.totalPrice(e),a=e.price-e.total_price?(t.totalPrice(e)-e.total_price).toFixed(2):null;return{$orig:n,m0:r,l0:s,m2:o,g2:a}})):null;return{$orig:n,g0:r,l1:s}}))),n=t.common.imgUrl("/static/wechat.png");t._isMounted||(t.e0=function(e){t.paymentMethod=1}),t.$mp.data=Object.assign({},{$root:{l2:i,g3:n}})},s=[]},ad5c:function(t,e,i){}},[["0ceb","common/runtime","common/vendor"]]]);