require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesShop/order/order"],{"0310":function(t,i,e){"use strict";(function(t,i){var n=e("47a9");e("6103");n(e("3240"));var o=n(e("6e35"));t.__webpack_require_UNI_MP_PLUGIN__=e,i(o.default)}).call(this,e("3223")["default"],e("df3c")["createPage"])},"13c4":function(t,i,e){"use strict";e.r(i);var n=e("b141"),o=e.n(n);for(var a in n)["default"].indexOf(a)<0&&function(t){e.d(i,t,(function(){return n[t]}))}(a);i["default"]=o.a},"47dd":function(t,i,e){},"6e35":function(t,i,e){"use strict";e.r(i);var n=e("b3d4"),o=e("13c4");for(var a in o)["default"].indexOf(a)<0&&function(t){e.d(i,t,(function(){return o[t]}))}(a);e("83c2");var d=e("828b"),s=Object(d["a"])(o["default"],n["b"],n["c"],!1,null,"11b99bd6",null,!1,n["a"],void 0);i["default"]=s.exports},"83c2":function(t,i,e){"use strict";var n=e("47dd"),o=e.n(n);o.a},b141:function(t,i,e){"use strict";(function(t){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n=e("bd40"),o=e("2c98"),a=e("d9a0"),d={WECHAT:1,WECHAT_CH:"微信",ALIPAY:2,ALIPAY_CH:"支付宝"},s={components:{},data:function(){return{detail:{org:"",product:[]},isios:!1,productTotal:0,ordertotal:0,isShowGift:!1,isSingle:0,giftInfo:[],giftSpecification:[],giftIndex:0,giftStockList:[],usableGiftList:[],isShowGiftCategory:!1,integralInfo:{},isSeparate:!1,purchaseInfo:[],idx:-1,addressId:0,idList:[],address:[],isIntegral:!1,integralText:"",discount_amount:"",is_pickup:!1,paymentList:[{id:d.WECHAT,img:"/static/wechat.png",name:d.WECHAT_CH,styles:"width:30rpx;height:30rpx"}],payment:0,orderId:0}},onLoad:function(i){var e=this;i.order_id&&(0,n.orderInfo)({id:i.order_id}).then((function(i){0===i.data.status&&0===i.data.uid?(e.detail=i.data,e.getIntegral(),e.getAddress(),e.discountsData()):t.showModal({title:"提示",content:"不是未支付订单",showCancel:!1,confirmText:"关闭",success:function(i){t.switchTab({url:"/pages/my/my"})}})})).catch((function(){t.switchTab({url:"/pages/my/my"})})),i.id&&(this.addressId=i.id),this.paymentList=[{id:d.WECHAT,img:"/static/wechat.png",name:d.WECHAT_CH,styles:"width:30rpx;height:30rpx"}]},onShow:function(){var i=this;t.getSystemInfo({success:function(t){"ios"==t.platform?i.$axios({url:i.$url[103]}).then((function(t){i.isios=t.data})):i.isios=!0}})},methods:{discounts:function(){var i,e=this.detail.product,n=[];e.forEach((function(t){var i=t.specifications.map((function(t){return t.name}));n.push({id:t.product_id,specifications:i})})),i={product:n,isPostage:!1,price:this.detail.total_price,oid:this.detail.oid},this.$store.commit("filterCoupon",i),t.navigateTo({url:"/pagesShop/members/discountCoupon?use=true&order_id="+this.detail.id})},orderFeeChange:function(){},call:function(i){t.makePhoneCall({phoneNumber:i})},discountsData:function(){var t=this.$store.state.discountCoupon;t.id&&(this.detail.couponsId=t.id,this.detail.couponInfo=t),this.orderFeeChange()},getIntegral:function(){var i=this;(0,n.getIntegral)().then((function(e){0===e.code?(i.isAdditionalPurchase=e.data.isAdditionalPurchase,i.integralInfo={integral:e.data.integral,max:e.data.max,proportion:e.data.proportion}):t.showToast({icon:"none",title:e.msg})}))},specificationsStatus:function(t){return t.specifications.map((function(t){return t.name})).join("/")},skip:function(i){console.log(i,"id"),i?t.navigateTo({url:"/pagesShop/commodity/detail?id="+i+"&forbid=true"}):t.redirectTo({url:"/pagesShop/address/index?mode=change"})},getAddress:function(){var i=this;(0,o.getDetail)({id:this.addressId}).then((function(e){t.hideLoading(),e.data.id&&(i.address=e.data,i.addressId=e.data.id)}))},goPay:function(){var i=this;if(t.showLoading({title:"加载中"}),this.orderId>0)return this.payOrder(),void t.hideLoading();if(!this.is_pickup&&!this.addressId)return t.showToast({icon:"none",title:"请选择地址"}),void t.hideLoading();var e={};e=this.is_pickup?{id:this.detail.id,couponsId:this.detail.couponsId,is_pickup:this.is_pickup,isIntegral:this.isIntegral}:{id:this.detail.id,couponsId:this.detail.couponsId,addressId:this.addressId,isIntegral:this.isIntegral},(0,n.stagingPayment)(e).then((function(e){t.hideLoading(),0===e.code?(i.orderId=i.detail.id,i.$store.commit("discountCoupon",{}),i.payOrder()):t.showToast({icon:"error",title:e.msg})})).catch((function(){t.hideLoading()}))},payOrder:function(){var i=this;t.showLoading({title:"加载中"});var e=this.paymentList[this.payment].id;if(e===d.WECHAT){(0,n.WxPayOrder)({id:this.orderId,status:0,openId:t.getStorageSync("openId")}).then((function(e){t.hideLoading(),0===e.code&&i.common.payment(e.data).then((function(t){0===t.code&&i.paymentSuccess()})).catch((function(t){}))})).catch((function(){t.hideLoading()}))}else e===d.ALIPAY?(0,n.AliPayOrder)({id:this.orderId}).then((function(i){t.hideLoading(),document.querySelector("body").innerHTML=i.data.resp,document.forms[0].submit()})).catch((function(){t.hideLoading()})):t.hideLoading()},paymentSuccess:function(){t.showModal({title:"提示",content:"支付成功",showCancel:!1,confirmText:"关闭",success:function(i){t.switchTab({url:"/pages/my/my"})}})},getCartList:function(){(0,a.getCartList)().then((function(i){i.data.length?t.setTabBarBadge({index:2,text:i.number}):t.removeTabBarBadge({index:2})}))},creditPoints:function(t){this.isIntegral=t.value,this.orderFeeChange()}}};i.default=s}).call(this,e("df3c")["default"])},b3d4:function(t,i,e){"use strict";e.d(i,"b",(function(){return o})),e.d(i,"c",(function(){return a})),e.d(i,"a",(function(){return n}));var n={uCheckbox:function(){return e.e("uview-ui/components/u-checkbox/u-checkbox").then(e.bind(null,"dc8f"))},uIcon:function(){return e.e("uview-ui/components/u-icon/u-icon").then(e.bind(null,"203b"))},uImage:function(){return e.e("uview-ui/components/u-image/u-image").then(e.bind(null,"31fd"))}},o=function(){var t=this,i=t.$createElement,e=(t._self._c,t.is_pickup?null:t.address.length),n=t.__map(t.detail.product,(function(i,e){var n=t.__get_orig(i),o=t.common.imgUrl(i.img),a=t.specificationsStatus(i);return{$orig:n,g1:o,m0:a}})),o=t.detail.couponInfo&&t.detail.couponInfo.name?((100*t.detail.couponInfo.price+100*t.detail.discount_amount)/100).toFixed(2):null,a=t.detail.couponInfo&&t.detail.couponInfo.name?((100*t.detail.total_price-100*t.detail.couponInfo.price)/100).toFixed(2):null,d=t.__map(t.paymentList,(function(i,e){var n=t.__get_orig(i),o=t.common.imgUrl(i.img);return{$orig:n,g4:o}})),s=t.detail.couponInfo&&t.detail.couponInfo.name?((100*t.detail.total_price-100*t.detail.couponInfo.price)/100).toFixed(2):null;t._isMounted||(t.e0=function(i){var e=[],n=arguments.length-1;while(n-- >0)e[n]=arguments[n+1];var o=e[e.length-1].currentTarget.dataset,a=o.eventParams||o["event-params"];i=a.index;return t.payment=i}),t.$mp.data=Object.assign({},{$root:{g0:e,l0:n,g2:o,g3:a,l1:d,g5:s}})},a=[]}},[["0310","common/runtime","common/vendor"]]]);