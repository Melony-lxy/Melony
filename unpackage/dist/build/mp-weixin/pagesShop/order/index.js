require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesShop/order/index"],{"443a":function(t,i,n){"use strict";n.r(i);var e=n("ff86"),o=n("a381");for(var a in o)["default"].indexOf(a)<0&&function(t){n.d(i,t,(function(){return o[t]}))}(a);n("4645");var s=n("828b"),r=Object(s["a"])(o["default"],e["b"],e["c"],!1,null,"1d8690b2",null,!1,e["a"],void 0);i["default"]=r.exports},4645:function(t,i,n){"use strict";var e=n("8c99"),o=n.n(e);o.a},"4a27":function(t,i,n){"use strict";(function(t){var e=n("47a9");Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var o=e(n("7ca3")),a=n("bd40"),s=n("2c98"),r=n("d9a0");function c(t,i){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);i&&(e=e.filter((function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),n.push.apply(n,e)}return n}function u(t){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?c(Object(n),!0).forEach((function(i){(0,o.default)(t,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))}))}return t}var d={WECHAT:1,WECHAT_CH:"微信",ALIPAY:2,ALIPAY_CH:"支付宝"},f={components:{},data:function(){return{isios:!1,productTotal:0,ordertotal:0,orderId:0,isShowGift:!1,isSingle:0,giftInfo:[],giftSpecification:[],giftIndex:0,giftStockList:[],usableGiftList:[],isShowGiftCategory:!1,integralInfo:{},isSeparate:!1,purchaseInfo:[],idx:-1,addressId:0,idList:[],address:[],isIntegral:!1,integralText:"",discount_amount:"",postage:0,is_pickup:!1,paymentList:[{id:d.WECHAT,img:"/static/wechat.png",name:d.WECHAT_CH,styles:"width:30rpx;height:30rpx"}],payment:0}},onLoad:function(i){t.showLoading({title:"加载中"}),i.id&&(this.addressId=i.id),this.paymentList=[{id:d.WECHAT,img:"/static/wechat.png",name:d.WECHAT_CH,styles:"width:30rpx;height:30rpx"}],this.isSeparate=this.$store.state.isSeparate,this.idList=this.$store.state.orderIdList,this.getIntegral(),this.purchaseInfoData(),this.purchasedData(),this.getAddress(),this.postageData(),this.discountsData()},onShow:function(){var i=this;t.getSystemInfo({success:function(t){"ios"==t.platform?i.$axios({url:i.$url[103]}).then((function(t){i.isios=t.data})):i.isios=!0}})},methods:{orderFeeChange:function(){var t=this,i={productList:this.purchaseInfo};(0,a.orderFee)(i).then((function(i){0==i.code&&i.data.forEach((function(i){t.purchaseInfo.forEach((function(n,e){n.oid==i.oid&&(i.total.isFullGift||(t.purchaseInfo[e].fullGiftList=[]),t.purchaseInfo[e].total=i.total)}))}));var n=0,e=0,o=0,a=0;if(t.purchaseInfo.forEach((function(t){n+=100*t.total.total_price,a+=100*t.total.price,e+=100*t.total.postage,o+=100*t.total.coupons_amount+100*t.total.postage_amount})),t.postage=e/100,t.ordertotal=n/100,t.productTotal=a/100,t.discount_amount=o/100,t.integralInfo.max>0&&t.integralInfo.proportion>0&&t.integralInfo.integral>0){var s=parseInt(n*t.integralInfo.max/100/100),r=parseInt(t.integralInfo.integral/t.integralInfo.proportion);r=r>s?s:r,t.integralText="现有积分"+t.integralInfo.integral+",可使用"+r*t.integralInfo.proportion+"积分抵用"+ +r+"元",t.isIntegral&&(t.ordertotal=(n-100*r)/100,t.discount_amount=(o+100*r)/100)}}))},call:function(i){t.makePhoneCall({phoneNumber:i})},commodityPrice:function(t){return(100*t.specificationsStatus.price*t.number/100).toFixed(2)},postageData:function(){var t=this.$store.state.postageCoupon;t.id&&(this.purchaseInfo=this.purchaseInfo.map((function(i){return i.oid===t.oid&&(i.postageId=t.id,i.postageInfo=t),i})),this.orderFeeChange())},discountsData:function(){var t=this.$store.state.discountCoupon;t.id&&(this.purchaseInfo=this.purchaseInfo.map((function(i){return i.oid===t.oid&&(i.couponsId=t.id,i.couponInfo=t),i})),this.orderFeeChange())},purchaseInfoData:function(){var t=[],i=(this.$store.state.purchaseInfo,[]),n=[],e=[],o=this.$store.state.purchasedSource;o&&(n=o.additionalPurchaseList,e=o.fullGiftList),this.$store.state.purchaseInfo.forEach((function(o){void 0!==i[o.org.oid]?t[i[o.org.oid]].list.push(u(u({},o),{},{remarks:""})):(i[o.org.oid]=i.length,t.push({remarks:"",oid:o.org.oid,name:o.org.name,fullGiftList:e[o.org.oid]?e[o.org.oid]:[],isAdditionalPurchase:o.isAdditionalPurchase,additionalPurchaseList:n[o.org.oid]?n[o.org.oid]:[],couponsId:0,postageId:0,postageInfo:{},total:{modeAct:0,isSingle:0,isFullGift:!1,coupons_amount:0,discount_amount:0,postage:10,postage_amount:0,price:100,total_price:110},list:[u(u({},o),{},{remarks:""})]}))})),this.purchaseInfo=t,this.orderFeeChange()},purchasedData:function(){var t=this.$store.state,i=t.addPurchasedList,n=t.purchasedSource;this.purchaseInfo=this.purchaseInfo.map((function(t){return t.oid===n.oid&&(t.additionalPurchaseList=[],i.forEach((function(i){t.additionalPurchaseList.push({product:i.product,product_id:i.product_id,specificationsStatus:i.specificationsStatus,specifications:i.specificationsStatus.name.map((function(t){return t.name})),id:i.id?i.id:0,number:i.number})}))),t})),this.orderFeeChange()},discounts:function(i,n){var e={},o=this.purchaseInfo[n];if("postage"===i)e={isPostage:!0,oid:o.oid};else{var a=[];o.list.forEach((function(t){var i=t.specificationsStatus.name.map((function(t){return t.name}));a.push({id:t.id?t.product.id:t.product_id,specifications:i})})),o.additionalPurchaseList.forEach((function(t){var i=t.specificationsStatus.name.map((function(t){return t.name}));a.push({id:t.product_id||t.id,specifications:i})})),e={product:a,isPostage:!1,price:o.total.total_price,oid:o.oid}}this.$store.commit("filterCoupon",e);var s=[],r=[];this.purchaseInfo.forEach((function(t){s[t.oid]=t.additionalPurchaseList,r[t.oid]=t.fullGiftList})),this.$store.commit("purchasedSource",{oid:o.oid,type:"order",additionalPurchaseList:s,fullGiftList:r}),t.navigateTo({url:"/pagesShop/members/discountCoupon?use=true"})},purchased:function(i){var n=[],e=[];this.purchaseInfo.forEach((function(t){n[t.oid]=t.additionalPurchaseList,e[t.oid]=t.fullGiftList}));var o=this.purchaseInfo[i];this.$store.commit("addPurchasedList",o.additionalPurchaseList),this.$store.commit("purchasedSource",{oid:o.oid,type:"order",additionalPurchaseList:n,fullGiftList:e}),t.navigateTo({url:"/pagesShop/order/purchased"})},fullGift:function(t){var i=this;this.idx=t;var n=this.purchaseInfo[t],e=[];n.fullGiftList.forEach((function(t){e[t.product_id]=t})),this.giftInfo=n.total.fullGiftList,this.giftInfo.map((function(t){return t.content="请选择",t.specifications=[],t.checked=!1,t.number=1,e[t.id]&&(t.content="已选："+i.specificationsStatus(e[t.id]),t.specifications=e[t.id].specificationsStatus.name.map((function(t){return t.name})),t.checked=!0,t.number=e[t.id].number),t})),this.isShowGift=!0},close:function(){this.isShowGift=!1},addCartChange:function(){var t=this,i=[];this.purchaseInfo[this.idx].fullGiftList.forEach((function(t){i[t.product_id]=t})),this.purchaseInfo[this.idx].fullGiftList=[],this.giftInfo.forEach((function(n){if(n.checked&&n.specifications.length>0){var e=[];n.specifications.forEach((function(t,i){e.push({type:n.stock_list.type[i].name,name:t})})),t.purchaseInfo[t.idx].fullGiftList.push({product:{img:n.img,name:n.name},product_id:n.id,specificationsStatus:{name:e},specifications:e.map((function(t){return t.name})),number:n.number,remarks:i[n.id]?i[n.id].remarks:""})}})),this.isShowGift=!1},pitchOn:function(t){this.giftInfo.map((function(i){return i.id===t.name&&(t.value||(i.content="请选择",i.specifications=[]),i.checked=t.value),i})),this.$forceUpdate()},giftCategory:function(i,n){var e=this;i.checked?(this.giftStockList=i.stock_list,this.usableGiftList=i.list,this.isShowGiftCategory=!0,this.giftSpecification=[],this.giftStockList.type.map((function(t,i){e.giftSpecification.push({index:0,name:t.list[0].name})})),this.giftIndex=n):t.showToast({icon:"none",title:"请先选中该赠品"})},gifeChange:function(t,i,n){this.giftSpecification[t]={index:i,name:n.name},this.$forceUpdate()},isShowGiftCategoryChange:function(){var t=this;this.giftSpecification.length===this.giftInfo[this.giftIndex].stock_list.type.length?(this.giftInfo[this.giftIndex].content="已选："+this.giftSpecification.map((function(t){return t.name})).join("/"),this.giftInfo[this.giftIndex].specifications=this.giftSpecification.map((function(t){return t.name})),this.giftInfo[this.giftIndex].checked=!0):(this.giftInfo[this.giftIndex].content="请选择",this.giftInfo[this.giftIndex].specifications=[],this.giftInfo[this.giftIndex].checked=!1),1===this.isSingle&&this.giftInfo.map((function(i){return t.giftInfo[t.giftIndex].id!==i.id&&(i.content="请选择",i.specifications=[],i.checked=!1),i})),this.isShowGiftCategory=!1},isShowGiftCategoryClose:function(){this.giftInfo.map((function(t){return 0===t.specifications.length&&(t.checked=!1),t})),this.isShowGiftCategory=!1},usableGiftListChange:function(t,i){return this.usableGiftList[i].indexOf(t.name)>-1},getIntegral:function(){var i=this;(0,a.getIntegral)().then((function(n){0===n.code?(i.isAdditionalPurchase=n.data.isAdditionalPurchase,i.integralInfo={integral:n.data.integral,max:n.data.max,proportion:n.data.proportion}):t.showToast({icon:"none",title:n.msg})}))},specificationsStatus:function(t){return t.specificationsStatus.name.map((function(t){return t.name})).join("/")},skip:function(i){console.log(i,"id"),i?t.navigateTo({url:"/pagesShop/commodity/detail?id="+i+"&forbid=true"}):t.redirectTo({url:"/pagesShop/address/index?mode=change"})},getAddress:function(){var i=this;(0,s.getDetail)({id:this.addressId}).then((function(n){t.hideLoading(),n.data.id&&(i.address=n.data,i.addressId=n.data.id)}))},goPay:function(){var i=this;if(t.showLoading({title:"加载中"}),this.orderId>0)return this.payOrder(),void t.hideLoading();if(!this.is_pickup&&!this.addressId)return t.showToast({icon:"none",title:"请选择地址"}),void t.hideLoading();var n={};n=this.is_pickup?{productList:this.purchaseInfo,is_pickup:this.is_pickup,isIntegral:this.isIntegral}:{productList:this.purchaseInfo,addressId:this.addressId,isIntegral:this.isIntegral},(0,a.orderAdd)(n).then((function(n){t.hideLoading(),0===n.code?(i.$store.commit("filterCoupon",{}),i.$store.commit("postageCoupon",{}),i.$store.commit("addPurchasedList",[]),i.$store.commit("discountCoupon",{}),i.orderId=n.data.id,i.payOrder()):t.showToast({icon:"error",title:n.msg})})).catch((function(){t.hideLoading()}))},payOrder:function(){var i=this;t.showLoading({title:"加载中"});var n=this.paymentList[this.payment].id;if(n===d.WECHAT){(0,a.WxPayOrder)({id:this.orderId,status:0,openId:t.getStorageSync("openId")}).then((function(n){t.hideLoading(),0===n.code&&i.common.payment(n.data).then((function(t){0===t.code&&i.paymentSuccess()})).catch((function(t){}))})).catch((function(){t.hideLoading()}))}else n===d.ALIPAY?(0,a.AliPayOrder)({id:this.orderId}).then((function(i){t.hideLoading(),document.querySelector("body").innerHTML=i.data.resp,document.forms[0].submit()})).catch((function(){t.hideLoading()})):t.hideLoading()},paymentSuccess:function(){t.showModal({title:"提示",content:"支付成功",showCancel:!1,confirmText:"关闭",success:function(i){t.switchTab({url:"/pages/my/my"})}})},getCartList:function(){(0,r.getCartList)().then((function(i){i.data.length?t.setTabBarBadge({index:2,text:i.number}):t.removeTabBarBadge({index:2})}))},creditPoints:function(t){this.isIntegral=t.value,this.orderFeeChange()}}};i.default=f}).call(this,n("df3c")["default"])},"8c99":function(t,i,n){},a381:function(t,i,n){"use strict";n.r(i);var e=n("4a27"),o=n.n(e);for(var a in e)["default"].indexOf(a)<0&&function(t){n.d(i,t,(function(){return e[t]}))}(a);i["default"]=o.a},b2e5:function(t,i,n){"use strict";(function(t,i){var e=n("47a9");n("6103");e(n("3240"));var o=e(n("443a"));t.__webpack_require_UNI_MP_PLUGIN__=n,i(o.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},ff86:function(t,i,n){"use strict";n.d(i,"b",(function(){return o})),n.d(i,"c",(function(){return a})),n.d(i,"a",(function(){return e}));var e={uCheckbox:function(){return n.e("uview-ui/components/u-checkbox/u-checkbox").then(n.bind(null,"dc8f"))},uIcon:function(){return n.e("uview-ui/components/u-icon/u-icon").then(n.bind(null,"203b"))},uImage:function(){return n.e("uview-ui/components/u-image/u-image").then(n.bind(null,"31fd"))},uInput:function(){return Promise.all([n.e("common/vendor"),n.e("uview-ui/components/u-input/u-input")]).then(n.bind(null,"7c31"))},uPopup:function(){return n.e("uview-ui/components/u-popup/u-popup").then(n.bind(null,"aa1b"))},uNumberBox:function(){return n.e("uview-ui/components/u-number-box/u-number-box").then(n.bind(null,"dcb0"))}},o=function(){var t=this,i=t.$createElement,n=(t._self._c,t.is_pickup?null:t.address.length),e=t.__map(t.purchaseInfo,(function(i,n){var e=t.__get_orig(i),o=i.total.isFullGift?i.fullGiftList.length:null,a=t.__map(i.list,(function(i,n){var e=t.__get_orig(i),o=t.common.imgUrl(i.product.img),a=t.specificationsStatus(i),s=i.gift.length,r=t.__map(i.gift,(function(i,n){var e=t.__get_orig(i),o=t.common.imgUrl(i.img),a=i.specifications.join("/");return{$orig:e,g4:o,g5:a}}));return{$orig:e,g2:o,m0:a,g3:s,l0:r}})),s=i.additionalPurchaseList.length,r=s?t.__map(i.additionalPurchaseList,(function(i,n){var e=t.__get_orig(i),o=t.common.imgUrl(i.product.img),a=t.specificationsStatus(i);return{$orig:e,g7:o,m1:a}})):null,c=i.fullGiftList.length,u=c?t.__map(i.fullGiftList,(function(i,n){var e=t.__get_orig(i),o=t.common.imgUrl(i.product.img),a=t.specificationsStatus(i);return{$orig:e,g9:o,m2:a}})):null,d=!t.is_pickup&&100*i.total.postage+100*i.total.postage_amount>0?((100*i.total.postage+100*i.total.postage_amount)/100).toFixed(2):null,f=i.total.total_price.toFixed(2);return{$orig:e,g1:o,l1:a,g6:s,l2:r,g8:c,l3:u,g10:d,g11:f}})),o=t.__map(t.paymentList,(function(i,n){var e=t.__get_orig(i),o=t.common.imgUrl(i.img);return{$orig:e,g12:o}})),a=t.giftInfo.length,s=a?t.__map(t.giftStockList.type,(function(i,n){var e=t.__get_orig(i),o=t.__map(i.list,(function(i,e){var o=t.__get_orig(i),a=t.usableGiftListChange(i,n),s=a&&i.img?t.common.imgUrl(i.img):null;return{$orig:o,m3:a,g14:s}}));return{$orig:e,l6:o}})):null;t._isMounted||(t.e0=function(i){var n=[],e=arguments.length-1;while(e-- >0)n[e]=arguments[e+1];var o=n[n.length-1].currentTarget.dataset,a=o.eventParams||o["event-params"];i=a.index;return t.payment=i}),t.$mp.data=Object.assign({},{$root:{g0:n,l4:e,l5:o,g13:a,l7:s}})},a=[]}},[["b2e5","common/runtime","common/vendor"]]]);