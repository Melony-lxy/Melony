require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesShop/commodity/detail"],{"1db3":function(t,i,e){"use strict";(function(t,n){var o=e("47a9");Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var a=o(e("7ca3")),c=o(e("01b7")),s=e("8f59"),r=e("d9a0"),u=o(e("653a"));function d(t,i){var e="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,i){if(!t)return;if("string"===typeof t)return l(t,i);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return l(t,i)}(t))||i&&t&&"number"===typeof t.length){e&&(t=e);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return c=t.done,t},e:function(t){s=!0,a=t},f:function(){try{c||null==e.return||e.return()}finally{if(s)throw a}}}}function l(t,i){(null==i||i>t.length)&&(i=t.length);for(var e=0,n=new Array(i);e<i;e++)n[e]=t[e];return n}function f(t,i){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);i&&(n=n.filter((function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),e.push.apply(e,n)}return e}function m(t){for(var i=1;i<arguments.length;i++){var e=null!=arguments[i]?arguments[i]:{};i%2?f(Object(e),!0).forEach((function(i){(0,a.default)(t,i,e[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):f(Object(e)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}))}return t}var h={components:{storeInformation:function(){e.e("components/storeInformation").then(function(){return resolve(e("33b5"))}.bind(null,e)).catch(e.oe)}},watch:{sharePopup:function(t,i){t&&(this.base64||this.generateQrCode())}},data:function(){return{showphone:!1,titlephone:"联系方式",contentphone:"1",sharePopup:!1,show:!1,forbid:!1,isDiscount:!1,mode:"",shoppingNumber:0,purchasedList:[],purchased:!1,isShowGife:!1,videoplay:"",id:0,base64:"",detail:null,isShowDiscounts:!1,isShowCategory:!1,isShowGift:!1,isShowGiftCategory:!1,specification:[],usableSpecificationList:[],activity:{is_single:0,proportion:"",fixed:""},commodityInfo:{uid:0,id:"",img:"",number:0,stock:0,price:"",sale_price:"",content:"",selectedIndex:"",selectedText:[],serialNumber:"",priceList:[0,0],is_discount:0,discount_price:""},giftStockList:[],usableGiftList:[],giftText:"请选择",giftSpecification:[],giftIndex:0,giftInfo:[],giftStatus:!0,selectiveGift:[],commodityList:[],currCategory:{},commentList:[],windowWidth:0}},onReady:function(){this.videoplay=t.createVideoContext("myVideo")},onLoad:function(i){t.getStorageSync("token");this.windowWidth=t.getWindowInfo().windowWidth,this.purchasedList=this.$store.state.addPurchasedList,i.purchased&&(this.purchased=!0),i.forbid&&(this.forbid=!0),this.id=parseInt(i.id),this.getDetail(),this.token&&this.getCartList(),this.commnentList()},onShareAppMessage:function(t){return{title:this.detail.name,imageUrl:this.detail.picture?this.common.imgUrl(this.detail.picture[0].url):"",path:"/pagesShop/commodity/detail?id="+this.id}},onShareTimeline:function(){return{title:this.detail.name,imageUrl:this.detail.picture?this.common.imgUrl(this.detail.picture[0].url):"",path:"/pagesShop/commodity/detail?id="+this.id}},methods:m(m({phonesucc:function(){n.makePhoneCall({phoneNumber:this.commodityInfo.phone,success:function(){console.log(1)},fail:function(){console.log(0)}})},toImage:function(){var t=this,i=window.document.getElementById("imageWrapper");(0,c.default)(i,{backgroundColor:null,useCORS:!0,scale:5}).then((function(i){var e=i.toDataURL("image/png");t.base64=e.toString()}))},generateQrCode:function(){var t=this;u.default.make({canvasId:"qrcode",componentInstance:this,text:" /h5/packgeA/login/login?commodityId=".concat(this.commodityInfo.id,"&store_id=").concat(this.commodityInfo.uid),size:60,margin:0,backgroundColor:"#ffffff",foregroundColor:"#000000",fileType:"jpg",errorCorrectLevel:u.default.errorCorrectLevel.H,success:function(i){t.toImage()}})},errorimg:function(t){this.commodityList[t].img=this.common.imgUrl("/static/images/default.png")},imgerror:function(t){this.detail.picture[t].url=this.common.imgUrl("/static/images/default.png"),this.detail.picture[t].type="image/jpeg"}},(0,s.mapMutations)(["commodity"])),{},{init:function(){var t=this;this.detail.stock_list.type.forEach((function(i,e){console.log(i.list,"item.list"),1===i.list.length&&t.commodityChange(e,0,i.list[0])}))},purchasedSkip:function(){this.$store.commit("purchasedSource",{type:"detail"}),t.navigateTo({url:"/pagesShop/order/purchased"})},getDetail:function(){var t=this;(0,r.productInfo)({id:this.id,isAdditionalPurchase:this.purchased}).then((function(i){if(console.log(i.data,"data"),0==i.code){t.detail=i.data,i.data.picture.map((function(i){i.url=t.common.imgUrl(i.url)}));var e="请选择 "+i.data.stock_list.type.map((function(t){return t.name})).join("/"),n=i.data.sale_price===i.data.max_sale_price?i.data.sale_price:i.data.sale_price+"~"+i.data.max_sale_price,o=i.data.discount_price===i.data.discount_price_max?i.data.discount_price:i.data.discount_price+"~"+i.data.discount_price_max;if(i.data.activityList.length){var a=i.data.activityList.filter((function(t){return 0===t.mode}));a.length&&(a=a[0].giftList.map((function(t){return t.checked=!1,t.content="请选择",t.specifications=[],t.number=1,t})),t.giftInfo=a),i.data.activityList.forEach((function(i){0===i.mode&&(t.activity.is_single=i.is_single,t.activity.giftList=i.giftList.map((function(t){return t.name}))),1===i.mode&&(t.activity.fixed=i.mode_act),2===i.mode&&(t.activity.proportion=i.mode_act)}))}t.purchased&&i.data.productList&&(t.usableSpecificationList=i.data.productList),t.isDiscount=i.data.activityList.some((function(t){return 2===t.mode})),t.commodityInfo={selectedIndex:"",id:i.data.id,img:i.data.img,number:i.data.min_count,stock:i.data.stock,sale_price:n||i.data.price,price:i.data.price,original_price:i.data.original_price,content:e,priceList:i.data.priceList,uid:i.data.uid,is_discount:i.data.is_discount,discount_price:o,ismianyi:i.data.mianyi,phone:i.data.phone,name:i.data.contact},console.log("this.commodityInfo",t.commodityInfo),i.data.recommend_id&&i.data.recommend_id.length&&t.listJson(i.data.recommend_id),t.init(),t.$forceUpdate()}}))},onPreviewImage:function(i){t.previewImage({urls:[this.common.imgUrl(i)],success:function(t){console.log(t,"res")},fail:function(t){console.log(t,"err")}})},ShowCategoryChange:function(){this.isShowCategory=!1,this.giftInfo.length&&!this.purchased&&(t.showToast({icon:"none",title:"请选择赠品规格"}),this.isShowGift=!0),this.giftInfo.length||this.purchased||("immediately"===this.mode&&this.purchase(),"add"===this.mode&&this.addCart())},getCartList:function(){var t=this;(0,r.getCartList)().then((function(i){t.shoppingNumber=i.number}))},listJson:function(t){var i=this;(0,r.listJson)({pages:1,limit:20,query:{idList:t}}).then((function(t){console.log(t,"res"),i.commodityList=t.data.data}))},usableGiftListChange:function(t,i){return this.usableGiftList[i].indexOf(t.name)>-1},usableSpecificationChange:function(t,i){return!this.usableSpecificationList.length||!this.purchased||this.usableSpecificationList[i].indexOf(t.name)>-1},isShowGiftChange:function(){if(this.detail.activityList.length){this.isShowGife=!1;var t,i=d(this.detail.activityList);try{for(i.s();!(t=i.n()).done;){var e=t.value;if(0===e.mode)for(var n in this.isShowGife=!0,e.list)-1==e.list[n].indexOf(this.commodityInfo.selectedText[n])&&(this.isShowGife=!1)}}catch(o){i.e(o)}finally{i.f()}this.isShowGife||(this.selectiveGift=[])}},maxNumber:function(){var t=this.giftSpecification.map((function(t){return t.index})).join("-"),i=this.detail.activityList.filter((function(t){return 0===t.mode}));i=!!i.length&&i[0].giftList[this.giftIndex].stock_list.list.filter((function(i){return i.index===t}))[0];var e=this.giftInfo[this.giftIndex].max_count;return i?i.stock>e?e:i.stock:0},commnentList:function(){var i=this;(0,r.commnentList)({id:this.id,page:1,limit:3}).then((function(e){0===e.code?i.commentList=e.data.data:t.showToast({icon:"none",title:e.msg})}))},close:function(){var i=[];this.giftInfo.filter((function(t){t.checked&&i.push({product_id:t.id,number:t.number,name:t.name,specifications:t.specifications,img:t.img})}));var e=i.every((function(t){return t.specifications.length}));if(!e)return t.showToast({icon:"none",title:"请选择赠品规格"}),void(this.giftStatus=!1);var n=this.giftInfo.filter((function(t){return t.checked})).map((function(t){return t.name})).join("/");this.giftText=n.length?"已选："+n:"请选择",this.giftStatus=!0,this.selectiveGift=i},giftCategory:function(i,e){i.checked?(this.giftStockList=i.stock_list,this.usableGiftList=i.list,this.isShowGiftCategory=!0,this.giftIndex!==e&&(this.giftSpecification=[]),this.giftIndex=e):t.showToast({icon:"none",title:"请先选中该赠品"})},pitchOn:function(t){0===this.activity.is_single?this.giftInfo.map((function(i){return i.id===t.name&&(t.value||(i.content="请选择",i.specifications=[]),i.checked=t.value),i})):this.giftInfo.map((function(i){return i.id===t.name?(t.value||(i.content="请选择",i.specifications=[]),i.checked=t.value):(i.content="请选择",i.specifications=[],i.checked=!1),i})),this.$forceUpdate()},showGift:function(){"请选择 规格/颜色"!==this.commodityInfo.content?this.isShowGift=!0:t.showToast({icon:"none",title:"请先选择商品规格"})},addCartChange:function(){this.isShowGift=!1,"add"===this.mode?(this.close(),this.addCart()):(this.close(),this.purchase())},addCart:function(){var i=this;this.mode="add";var e=[];console.log(this.selectiveGift,"selectiveGift"),this.selectiveGift.length&&this.selectiveGift.forEach((function(t){e.push({product_id:t.product_id,number:t.number,specifications:t.specifications,img:t.img})}));var n={product_id:this.id,number:this.commodityInfo.number,specifications:this.commodityInfo.selectedText,gift:e,type:0};return this.commodityInfo.selectedIndex||0===this.detail.stock_list.type.length?!n.gift.length&&this.giftInfo.length?(t.showToast({icon:"none",title:"请选择赠品"}),void(this.isShowGift=!0)):void(0,r.addCart)(n).then((function(e){0==e.code?(t.showToast({icon:"none",title:"添加成功",duration:2e3}),i.getCartList(),i.isShowCategory=!1):(t.showToast({icon:"none",title:"添加失败："+e.msg,duration:2e3}),i.isShowCategory=!1)})):(t.showToast({icon:"none",title:"请选择商品属性"}),void(this.isShowCategory=!0))},skip:function(i){t.navigateTo({url:i})},homeSkip:function(i){t.switchTab({url:i})},commentLink:function(){t.navigateTo({url:"/pagesShop/commodity/commentList?id="+this.id})},numberChange:function(t){this.commodityInfo.number=t.value},gifeChange:function(t,i,e){this.giftSpecification[t]={index:i,name:e.name},this.giftSpecification.length===this.giftInfo[this.giftIndex].stock_list.type.length&&(this.giftInfo[this.giftIndex].content="已选："+this.giftSpecification.map((function(t){return t.name})).join("/"),this.giftInfo[this.giftIndex].specifications=this.giftSpecification.map((function(t){return t.name}))),this.$forceUpdate()},commodityChange:function(t,i,e){var n=this;if(this.specification[t]={index:i,name:e.name},this.commodityInfo.number=this.detail.min_count,0===t&&e.img&&(this.commodityInfo.img=e.img),this.specification.length===this.detail.stock_list.type.length){this.commodityInfo.selectedIndex=this.specification.map((function(t){return t.index})).join("-");var o=this.detail.stock_list.list.find((function(t){return t.index===n.commodityInfo.selectedIndex}));this.commodityInfo.content="已选："+this.specification.map((function(t){return t.name})).join("/"),this.commodityInfo.price=o.price,this.commodityInfo.sale_price=o.sale_price?o.sale_price:o.price,this.commodityInfo.stock=o.stock,this.commodityInfo.original_price=o.original_price,this.commodityInfo.serialNumber=o.number,this.commodityInfo.selectedText=this.specification.map((function(t){return t.name}))}this.isShowGiftChange(),this.$forceUpdate()},addPurchasedList:function(){var i=this;if(!this.commodityInfo.selectedIndex&&0!==this.detail.stock_list.type.length)return t.showToast({icon:"none",title:"请选择商品属性"}),void(this.isShowCategory=!0);this.isShowCategory=!1;var e=[];this.commodityInfo.selectedText.forEach((function(t){return e.push({name:t})})),console.log(this.detail,"this.detail");var n=[{product_id:this.detail.id,number:this.commodityInfo.number,product:{activityList:this.detail.activityList,img:this.detail.img,name:this.detail.name,min_count:this.detail.min_count,postage:this.detail.postage},gift:this.selectiveGift,specificationsStatus:{img:this.commodityInfo.img,name:e,price:this.commodityInfo.price}}],o=this.purchasedList;if(this.purchasedList.length){this.purchasedList.forEach((function(t,e){t.product_id===i.detail.id&&o.splice(e,1,n[0])}));var a=o.every((function(t){return t.product_id!==i.detail.id}));a&&(o=o.concat(n))}else o=n;this.$store.commit("addPurchasedList",o),t.navigateBack()},purchase:function(i){if(1!=i){if(this.mode="immediately",!this.commodityInfo.selectedIndex&&0!==this.detail.stock_list.type.length)return t.showToast({icon:"none",title:"请选择商品属性"}),void(this.isShowCategory=!0);this.isShowCategory=!1;var e=[];this.commodityInfo.selectedText.forEach((function(t){return e.push({name:t})}));var n=[{org:{oid:this.detail.org.id,name:this.detail.org.name},product_id:this.detail.id,number:this.commodityInfo.number,product:{activityList:this.detail.activityList,img:this.detail.img,name:this.detail.name,min_count:this.detail.min_count,postage:this.detail.postage},gift:this.selectiveGift,specificationsStatus:{img:this.commodityInfo.img,name:e,price:this.commodityInfo.price},specifications:e.map((function(t){return t.name}))}];this.$store.commit("purchaseInfo",n),this.$store.commit("isSeparate",!0),t.navigateTo({url:"/pagesShop/order/index"})}else this.showphone=!0}})};i.default=h}).call(this,e("df3c")["default"],e("3223")["default"])},"20f7":function(t,i,e){"use strict";e.r(i);var n=e("cb75"),o=e("482e");for(var a in o)["default"].indexOf(a)<0&&function(t){e.d(i,t,(function(){return o[t]}))}(a);e("6baa");var c=e("828b"),s=Object(c["a"])(o["default"],n["b"],n["c"],!1,null,"a0c5d0f0",null,!1,n["a"],void 0);i["default"]=s.exports},"482e":function(t,i,e){"use strict";e.r(i);var n=e("1db3"),o=e.n(n);for(var a in n)["default"].indexOf(a)<0&&function(t){e.d(i,t,(function(){return n[t]}))}(a);i["default"]=o.a},"597e":function(t,i,e){"use strict";(function(t,i){var n=e("47a9");e("6103");n(e("3240"));var o=n(e("20f7"));t.__webpack_require_UNI_MP_PLUGIN__=e,i(o.default)}).call(this,e("3223")["default"],e("df3c")["createPage"])},"6baa":function(t,i,e){"use strict";var n=e("dfa0"),o=e.n(n);o.a},cb75:function(t,i,e){"use strict";e.d(i,"b",(function(){return o})),e.d(i,"c",(function(){return a})),e.d(i,"a",(function(){return n}));var n={uImage:function(){return e.e("uview-ui/components/u-image/u-image").then(e.bind(null,"31fd"))},uIcon:function(){return e.e("uview-ui/components/u-icon/u-icon").then(e.bind(null,"203b"))},uPopup:function(){return e.e("uview-ui/components/u-popup/u-popup").then(e.bind(null,"aa1b"))},uNumberBox:function(){return e.e("uview-ui/components/u-number-box/u-number-box").then(e.bind(null,"dcb0"))},uCheckbox:function(){return e.e("uview-ui/components/u-checkbox/u-checkbox").then(e.bind(null,"dc8f"))},uBadge:function(){return e.e("uview-ui/components/u-badge/u-badge").then(e.bind(null,"8592"))},uModal:function(){return e.e("uview-ui/components/u-modal/u-modal").then(e.bind(null,"31b2"))}},o=function(){var t=this,i=t.$createElement,e=(t._self._c,t.detail?t.__map(t.detail.picture,(function(i,e){var n=t.__get_orig(i),o=i.type.indexOf("image"),a=o>=0?t.common.imgUrl(i.url):null;return{$orig:n,g0:o,g1:a}})):null),n=t.detail?t.detail.activityList.length:null,o=t.detail?t.common.imgUrl("/static/shop/common/inventory.png"):null,a=t.detail?t.common.imgUrl("/static/shop/common/sales.png"):null,c=t.detail?t.giftInfo.length&&!t.purchased:null,s=t.detail?t.detail.introduction.length:null,r=t.detail?t.commentList.length:null,u=t.detail?t.commentList.length:null,d=t.detail&&u?t.__map(t.commentList,(function(i,e){var n=t.__get_orig(i),o=t.common.imgUrl(i.user.avatar_url),a=i.file.length,c=a?t.__map(i.file,(function(i,e){var n=t.__get_orig(i),o=t.common.imgUrl(i.url);return{$orig:n,g11:o}})):null;return{$orig:n,g9:o,g10:a,l1:c}})):null,l=t.detail?t.common.content(t.detail.content):null,f=t.detail?t.commodityList.length:null,m=t.detail&&f?t.__map(t.commodityList,(function(i,e){var n=t.__get_orig(i),o=t.common.imgUrl(i.img);return{$orig:n,g14:o}})):null,h=t.detail?t.common.imgUrl(t.commodityInfo.img):null,g=t.detail?t.__map(t.detail.stock_list.type,(function(i,e){var n=t.__get_orig(i),o=t.__map(i.list,(function(i,n){var o=t.__get_orig(i),a=t.usableSpecificationChange(i,e),c=a&&i.img?t.common.imgUrl(i.img):null;return{$orig:o,m0:a,g16:c}}));return{$orig:n,l4:o}})):null,p=t.detail?t.giftInfo.length:null,y=t.detail&&p?t.__map(t.giftStockList.type,(function(i,e){var n=t.__get_orig(i),o=t.__map(i.list,(function(i,n){var o=t.__get_orig(i),a=t.usableGiftListChange(i,e),c=a&&i.img?t.common.imgUrl(i.img):null;return{$orig:o,m1:a,g18:c}}));return{$orig:n,l6:o}})):null,v=t.detail&&p?t.maxNumber():null,_=!t.detail||t.forbid||t.purchased?null:t.common.imgUrl("/static/pageShop/index.png"),b=!t.detail||t.forbid||t.purchased?null:t.common.imgUrl("/static/pageShop/chat.png"),I=!t.detail||t.forbid||t.purchased?null:t.common.imgUrl("/static/pageShop/car.png"),w=t.detail&&!t.base64?t.common.imgUrl(t.detail.picture[0].url):null;t._isMounted||(t.e0=function(i){t.sharePopup=!0},t.e1=function(i){t.isShowCategory=!0},t.e2=function(i){t.isShowGiftCategory=!1},t.e3=function(){t.show=!1}),t.$mp.data=Object.assign({},{$root:{l0:e,g2:n,g3:o,g4:a,g5:c,g6:s,g7:r,g8:u,l2:d,g12:l,g13:f,l3:m,g15:h,l5:g,g17:p,l7:y,m2:v,g19:_,g20:b,g21:I,g22:w}})},a=[]},dfa0:function(t,i,e){}},[["597e","common/runtime","common/vendor","pagesShop/common/vendor"]]]);