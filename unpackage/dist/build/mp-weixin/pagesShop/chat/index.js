require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesShop/chat/index"],{1800:function(t,n,e){"use strict";e.r(n);var i=e("ba0f"),o=e("d06d");for(var s in o)["default"].indexOf(s)<0&&function(t){e.d(n,t,(function(){return o[t]}))}(s);e("ad42");var c=e("828b"),a=Object(c["a"])(o["default"],i["b"],i["c"],!1,null,"64441c92",null,!1,i["a"],void 0);n["default"]=a.exports},1890:function(t,n,e){},ad42:function(t,n,e){"use strict";var i=e("1890"),o=e.n(i);o.a},b302:function(t,n,e){"use strict";(function(t,n){var i=e("47a9");e("6103");i(e("3240"));var o=i(e("1800"));t.__webpack_require_UNI_MP_PLUGIN__=e,n(o.default)}).call(this,e("3223")["default"],e("df3c")["createPage"])},ba0f:function(t,n,e){"use strict";e.d(n,"b",(function(){return o})),e.d(n,"c",(function(){return s})),e.d(n,"a",(function(){return i}));var i={uImage:function(){return e.e("uview-ui/components/u-image/u-image").then(e.bind(null,"31fd"))},uIcon:function(){return e.e("uview-ui/components/u-icon/u-icon").then(e.bind(null,"203b"))}},o=function(){var t=this,n=t.$createElement,e=(t._self._c,t.list?t.__map(t.list,(function(n,e){var i=t.__get_orig(n),o=JSON.stringify(n.id),s=n.self?null:t.common.imgUrl(t.avatar),c=n.self||1!==n.content_type?null:t.common.imgUrl(n.content),a=n.self||1===n.content_type?null:t.common.content(n.content),r=n.self&&1!==n.content_type?t.common.content(n.content):null,l=n.self&&1===n.content_type?t.common.imgUrl(n.content):null,u=n.self?t.common.imgUrl(t.headPortrait):null;return{$orig:i,g0:o,g1:s,g2:c,g3:a,g4:r,g5:l,g6:u}})):null),i=t.common.imgUrl("/static/shop/common/keyboard.png");t.$mp.data=Object.assign({},{$root:{l0:e,g7:i}})},s=[]},d06d:function(t,n,e){"use strict";e.r(n);var i=e("db28"),o=e.n(i);for(var s in i)["default"].indexOf(s)<0&&function(t){e.d(n,t,(function(){return i[t]}))}(s);n["default"]=o.a},db28:function(t,n,e){"use strict";(function(t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i,o=e("0225"),s=e("babc"),c={data:function(){return{focus:!1,windowHeight:1e3,totalCount:0,iskeyboard:!1,centent:"",isStaffService:!1,avatar:"",headPortrait:"",scrollTop:"",nav:[{title:"人工服务"}],list:[],isPc:!0,scrollwhich:0,scrollall:999999,monitorKeyboard:null,serviceName:"客服",bottomheight:0,scrollHeight:0,ScrollAnimation:!1,lookingmore:!0,autoheight:!0,wxheight:0}},onLoad:function(){var n=this;this.stop(),this.getList({limit:20}),this.userInfo(),this.$storage.getStorageSync("isStaffService")&&(this.isStaffService=!0,this.nav[0].title=this.isStaffService?"结束人工对话":"人工服务"),this.serviceInfo(),this.$nextTick((function(){var e=n;t.getSystemInfo({success:function(t){e.wxheight=t.windowHeight}});var i=t.createSelectorQuery().select("#inputs");i.boundingClientRect((function(t){e.windowHeight=e.wxheight-t.height})).exec(),e.setscroll()}))},onShow:function(){t.onKeyboardHeightChange((function(t){console.log(t.height)}))},onUnload:function(){if(this.focus){var n=t.getSystemInfoSync().platform;this.focus=!1,"ios"==n||"android"==n&&this.$nextTick((function(){}))}},watch:{centent:function(t,n){this.$nextTick((function(){}))},list:function(t,n){t.length}},methods:{scroll:function(){if(this.focus){var n=t.getSystemInfoSync().platform;"ios"==n&&(this.focus=!1)}},stop:function(){},getKeyboardState:function(){var n=this;this.monitorKeyboard=new MonitorKeyboard,this.monitorKeyboard.onStart(),this.monitorKeyboard.onShow((function(){n.focus=!0,n.scrollwhich=n.windowHeight;var e=t.getSystemInfoSync().platform;"ios"==e||"android"==e&&setTimeout((function(){n.bottomheight=document.getElementById("inputs").offsetHeight,t.getSystemInfo({success:function(t){n.isPc,n.windowHeight=t.windowHeight-n.bottomheight}});var e=t.getSystemInfoSync();n.windowHeight=e.windowHeight-n.bottomheight,setTimeout((function(){n.setscroll()}),200)}),300)})),this.monitorKeyboard.onHidden((function(){n.$nextTick((function(){this.windowHeight=this.scrollwhich,this.setscroll()}))}))},onPreviewImage:function(n){t.previewImage({urls:[this.common.imgUrl(n)],success:function(t){console.log(t,"res")},fail:function(t){console.log(t,"err")}})},linechange:function(t){},onImage:function(){var n=this;t.chooseImage({count:1,sizeType:["original","compressed"],success:function(e){e.tempFilePaths.forEach((function(e){t.uploadFile({url:n.$base_url+"/index/common/uploadFile",filePath:e,fileType:"image",method:"POST",name:"file",formData:{name:"file"},success:function(t){n.sendMsg({content:JSON.parse(t.data).data.url,content_type:1})}})}))}})},onreachTop:function(){if(this.lookingmore){if(this.lookingmore=!1,this.list.length<this.totalCount)return void this.getList({chatId:this.list[0].id,limit:20},!0);t.showToast({icon:"none",title:"到底了"})}},userInfo:function(){var t=this;(0,s.userInfo)().then((function(n){0===n.code&&(t.headPortrait=n.data.avatar_url)}))},getList:function(n,e){var i=this;t.showLoading({title:"加载中"}),(0,o.getList)(n).then((function(n){i.list=e?n.data.concat(i.list):i.list.concat(n.data),i.totalCount=n.count,i.$storage.setStorage("isStaffService",n.status),i.nav[0].title=n.status?"结束人工对话":"人工服务",t.hideLoading(),n.status&&i.setInterval(),setTimeout((function(){e||setTimeout((function(){i.setscroll()}),100),0==i.lookingmore&&(i.lookingmore=!0)}),100)})).catch((function(n){t.hideLoading()}))},setscroll:function(){var t=this;this.scrollTop="",this.$nextTick((function(){0!=t.list.length&&(t.scrollTop="s".concat(t.list[t.list.length-1].id))}))},imgUrl:function(t){return t?"http"!=t.substring(0,4)?this.$base_url+t:t:""},adddArtificial:function(){var t=this;(0,o.adddArtificial)().then((function(n){t.$storage.setStorage("isStaffService",!0),t.isStaffService=!0,t.list=t.list.concat(n.data),setTimeout((function(){t.setscroll()}),100),t.nav[0].title=t.isStaffService?"结束人工对话":"人工服务",t.setInterval()}))},endArtificial:function(){var t=this;(0,o.endArtificial)().then((function(n){t.isStaffService=!1,t.nav[0].title=t.isStaffService?"结束人工对话":"人工服务",t.list=t.list.concat(n.data),setTimeout((function(){t.setscroll()}),100),t.$storage.removeStorage("isStaffService"),clearInterval(i)}))},setInterval:function(t){function n(){return t.apply(this,arguments)}return n.toString=function(){return t.toString()},n}((function(){var t=this;i=setInterval((function(){t.getAcceptList({chatId:t.list.length>1?t.list[t.list.length-1].id:0})}),5e3)})),getAcceptList:function(t){var n=this;(0,o.getAcceptList)(t).then((function(t){n.list=n.list.concat(t.data),n.$storage.setStorage("isStaffService",t.status),n.nav[0].title=n.isStaffService?"结束人工对话":"人工服务",t.status||(clearInterval(i),n.nav[0].title="人工服务"),0!=t.data.length&&setTimeout((function(){n.setscroll()}),100)}))},sendMsg:function(t){var n=this;(0,o.sendMsg)(t).then((function(t){n.list=n.list.concat(t.data),n.centent="",setTimeout((function(){n.setscroll()}),100)}))},send:function(){if(this.centent){var t={content:this.centent,content_type:0};this.sendMsg(t)}},select:function(n){"门店查询"===n.title?t.navigateTo({url:n.url}):this.$storage.getStorageSync("isStaffService")?(this.isStaffService=!1,this.endArtificial()):this.adddArtificial()},skip:function(n){t.navigateTo({url:n})},serviceInfo:function(){var t=this;(0,o.serviceInfo)().then((function(n){t.serviceName=n.data.service_name,t.avatar=n.data.service_avatar_url}))}}};n.default=c}).call(this,e("df3c")["default"])}},[["b302","common/runtime","common/vendor","pagesShop/common/vendor"]]]);